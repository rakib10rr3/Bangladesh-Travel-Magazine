{% extends 'app1/base.html' %}

{##}
{#changed#}

{% block body_block %}
    <div class="jumbotron gp-jumbotron">
        <h1>Share your experience with others!</h1>
    </div>
    <div class="container-fluid gp-container-normal">
        <form class="gp-form" role="form" id="story_form" method="post" action="." enctype="multipart/form-data">
            {% csrf_token %}
            {% for hidden in form.hidden_fields %}
                {{ hidden }}
            {% endfor %}
            {% for field in form.visible_fields %}
                <div class="form-group">
                    <p class="required">{{ field.help_text }}</p>
                    {{ field.errors }}
                    {{ field }}
                </div>
            {% endfor %}
            <input type="file" id="files" name="myfiles" multiple>

            <output id="result"></output>

            <button class="btn btn-lg btn-primary btn-block" type="submit">Share</button>
        </form>
    </div>

{% endblock %}

{% block javascript_block %}

    <script type="text/javascript">

        {#        document.getElementById("files").onchange = function () {#}
        {#            var reader = new FileReader();#}
        {#            reader.onload = function (e) {#}
        {#                document.getElementById("image").src = e.target.result;#}
        {#            };#}
        {#            reader.readAsDataURL(this.files[0]);#}
        {#        };#}
        window.onload = function () {

            //Check File API support
            if (window.File && window.FileList && window.FileReader) {
                var filesInput = document.getElementById("files");

                filesInput.addEventListener("change", function (event) {

                    var files = event.target.files; //FileList object
                    var output = document.getElementById("result");

                    for (var i = 0; i < files.length; i++) {
                        var file = files[i];

                        //Only pics
                        if (!file.type.match('image'))
                            continue;

                        var picReader = new FileReader();

                        picReader.addEventListener("load", function (event) {

                            var picFile = event.target;

                            var div = document.createElement("div");

                            div.innerHTML = "<img style='height: 75px; border: 1px solid #000; margin: 5px'  class='thumbnail' src='" + picFile.result + "'" +
                                "title='" + picFile.name + "'/> <a href='#' class='remove_pict'>X</a>";

                            output.insertBefore(div, null);
                            div.children[1].addEventListener("click", function (event) {
                                div.parentNode.removeChild(div);
                            });

                        });

                        //Read the image
                        picReader.readAsDataURL(file);
                    }

                });
            }
            else {
                console.log("Your browser does not support File API");
            }
        }

    </script>

{% endblock %}

<!-- creating custom change list -->