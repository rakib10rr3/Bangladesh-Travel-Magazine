{% load el_pagination_tags %}
{% paginate 4 stories %}
{% for obj in stories %}

    {% if  obj.user.userprofile.image %}
        <img src="{{ obj.user.userprofile.image.url }}" alt="{{ obj.user }}" width="50" height="50">
    {% else %}
        <img src="/media/default-placeholder.png" class="img-circle" alt="{{ obj.user }}" width="50"
             height="50">
    {% endif %}


    <a href="{% url 'user_profile' obj.user %}">{{ obj.user }}</a>

    <strong>{{ obj.member }}</strong> members.
    {#                        <h3>Debug : {{ obj.user.id }}</h3>#}
    {% load app1_extras %}
    <div id="follow{{ forloop.counter }}">
        {% if not obj.user == request.user %}
            {% pass_follower_list request.user obj.user.id forloop.counter %}
        {% endif %}
    </div>

    <div class="gp-div-post-full">

        {% if obj.stories.all.exists %}

            <div class="gp-slide-show">
                <div class="gp-slide-shadow"></div>
                <div id="storyCarousel{{ forloop.counter }}" class="carousel slide gp-carousel"
                     data-ride="carousel">
                    <!-- Wrapper for slides -->

                    <div class="carousel-inner" role="listbox">

                        {% for obj2 in  obj.stories.all %}
                            <div class="item {% if forloop.first %}active{% endif %}">
                                <img class="card-img-top gp-card-img" src="{{ obj2.file.url }}">
                            </div>
                        {% endfor %}

                    </div>
                    <!-- Left and right controls -->
                    <a class="left carousel-control" id="gp-carousel-control"
                       href="#storyCarousel{{ forloop.counter }}"
                       role="button"
                       data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="right carousel-control" id="gp-carousel-control"
                       href="#storyCarousel{{ forloop.counter }}"
                       role="button"
                       data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            {#                    {% else %}#}
            {#                        <p class="gp-post-no-image-text">No images shared by <strong>{{ obj.user }}</strong>.</p>#}
        {% endif %}

        <div class="gp-desc">
            <h4 class="card-title">{{ obj.title_name }}</h4>
            <p class="card-text-date">{{ obj.created_date }}</p>


            <p class="card-budget"><strong>Budget:</strong> {{ obj.budget }}</p>
            <p class="card-type"><strong>Type:</strong> {{ obj.type_name }}</p>
            <p class="card-text">
                {% if obj.des|length > 50 %}
                    {{ obj.des|linebreaks|safe|truncatewords:"50" }}
                    <a href="{% url 'story_detail' obj.id %}">Read Full Story</a>
                {% else %}
                    {{ obj.des|linebreaks|safe }}
                {% endif %}

            </p>
        </div>
        <div class="gp-util-bar">
            <div class="gp-div-half">
                <a id="likes" data-id="{{ obj.id }}" class="gp-like-button">
                            <span id="gp-like-logo-{{ obj.id }}"
                                  class="glyphicon {% if obj.id in like_list %}glyphicon glyphicon-heart {% else %} glyphicon-heart-empty {% endif %}"></span>
                    <span id="gp-total-like-{{ obj.id }}">{{ obj.total_likes }}</span>
                </a>
            </div>
            <div class="gp-div-half">
                <a class="gp-share"><span class="glyphicon glyphicon-share-alt"></span> Share</a>
            </div>
        </div>

        <!-- Comment show start -->
        <div class="gp-comment-group">
            <div class="gp-total-comments">
                <a onclick="toggleDiv(this,{{ forloop.counter }})" class="gp-flat-link">
                    Total {{ obj.comments.count }} comments.
                </a>
            </div>

            <div id="{{ forloop.counter }}">
                {% for comment in obj.comments.all %}
                    <div class="gp-comment">
                        <p class="gp-username"><a
                                href="{% url 'user_profile' comment.author.username %}">{{ comment.author.username }}</a>
                        </p>
                        <p class="gp-date">{{ comment.created_date }}</p>
                        <p class="gp-content">{{ comment.text }}</p>

                        {% if comment.id in comment_list %}
                            <div class="bg-margin-top-10">
                                <button class="btn btn-danger"
                                        onclick="del_comment( {{ forloop.parentloop.counter }}, {{ comment.id }})">
                                    Delete
                                </button>
                            </div>
                        {% endif %}

                    </div>
                {% endfor %}
            </div>
            <!-- Comment show end -->


            <!-- Adding a comment part start -->

            <form id="add_comment{{ forloop.counter }}" data-id={{ obj.id }} method="POST"
                  class="gp-form-story-comment">
                {% csrf_token %}
                <div class="input-group">
                    <input class="form-control" type="text" id="text{{ forloop.counter }}"
                           maxlength="1000" name="text" required>
                    <div class="input-group-btn">
                        <button class="btn btn-default" onclick="commentDiv({{ forloop.counter }})"
                                type="submit">
                            <i class="glyphicon glyphicon-send"></i>
                        </button>
                    </div>
                </div>

            </form>

            <!-- Adding-Comment part end -->
        </div>
    </div>
{% endfor %}
{% show_more %}